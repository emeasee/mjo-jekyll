function elementToTemplate(a){return a.get(0).outerHTML}function scrollTop(){$body.find(".blog").add($html).scrollTop(0)}function pageState(){return{index:ArticleAnimator.currentPostIndex,current:elementToTemplate(ArticleAnimator.$current),next:elementToTemplate(ArticleAnimator.$next)}}function getURLIndex(){return parseInt(history.state&&history.state.index||window.location.hash.replace("#","")||ArticleAnimator.currentPostIndex,10)}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),jQuery.ajaxSetup({cache:!1});var ArticleAnimator=ArticleAnimator||{canScroll:!0,initialLoad:!0,animationDuration:500,postCount:numPosts,currentPostIndex:numPosts,postCache:{},pageTemplate:null};ArticleAnimator.load=function(){this.currentPostIndex=getURLIndex(),this.makeSelections(),$body.css({overflow:"hidden"}).find(".dark").fadeIn("fast"),$body.find(".blog").addClass("open").append(this.$current),$body.find(".blog").append(this.$next);var a=this;this.createPost({type:"current"},function(){a.createPost({type:"next"},function(){a.refreshCurrentAndNextSelection(),a.bindGotoNextClick(),a.bindPopstate(),a.bindWindowScroll()})})},ArticleAnimator.makeSelections=function(){this.$page=$(".page"),this.pageTemplate=elementToTemplate(this.$page.clone()),this.$current=this.currentElementClone(),this.$next=this.nextElementClone()},ArticleAnimator.getPost=function(a,b){if(b=b||$.noop,this.postCache[a])return void b(this.postCache[a]);var c=this;$.getJSON("/json/post_"+a+".json",function(d){c.postCache[a]=d,b(d)})},ArticleAnimator.nextPostIndex=function(a){return 1===a?this.postCount:a-1},ArticleAnimator.createPost=function(a,b){a=a||{};var c=this,d=a.type||"next";a.fromTemplate&&($body.find(".blog").append(this.nextElementClone()),this["$"+d]=$("."+d));var e="next"===d?this.nextPostIndex(this.currentPostIndex):this.currentPostIndex;this.getPost(e,function(a){c.contentizeElement(c["$"+d],a),b&&b()})},ArticleAnimator.contentizeElement=function(a,b){a.find(".big-image").css({backgroundImage:"url("+b.image+")"}),a.find("h1.title").html(b.title),a.find("h2.description").html(b.title_secondary),a.find(".content .text").html(b.content),a.find("h3.byline time").html(b.date),a.find("h3.byline .author").html(b.author)},ArticleAnimator.animatePage=function(a){var b=this,c=this.$next.get(0).getBoundingClientRect().top;this.canScroll=!1,this.$current.addClass("fade-up-out"),this.$next.removeClass("content-hidden next").addClass("easing-upward").css({transform:"translate3d(0, -"+c+"px, 0)"}),setTimeout(function(){scrollTop(),b.$next.removeClass("easing-upward"),b.$current.remove(),b.$next.css({transform:""}),b.$current=b.$next.addClass("current"),b.canScroll=!0,b.currentPostIndex=b.nextPostIndex(b.currentPostIndex),a()},b.animationDuration)},ArticleAnimator.bindGotoNextClick=function(){var a=this,b="ontouchstart"in window?"touchstart":"click";this.$next.find(".big-image").on(b,function(b){b.preventDefault(),$(this).unbind(b),a.animatePage(function(){a.createPost({fromTemplate:!0,type:"next"}),a.bindGotoNextClick(),history.pushState(pageState(),"","#"+a.currentPostIndex)})})},ArticleAnimator.bindPopstate=function(){var a=this;$window.on("popstate",function(){return!history.state||a.initialLoad?void(a.initialLoad=!1):(a.currentPostIndex=history.state.index,a.$current.replaceWith(history.state.current),a.$next.replaceWith(history.state.next),a.refreshCurrentAndNextSelection(),a.createPost({type:"next"}),void a.bindGotoNextClick())})},ArticleAnimator.bindWindowScroll=function(){var a=this;$window.on("mousewheel",function(b){a.canScroll||b.preventDefault()})},ArticleAnimator.refreshCurrentAndNextSelection=function(){this.$current=$(".page.current"),this.$next=$(".page.next")},ArticleAnimator.nextElementClone=function(){return this.$page.clone().removeClass("hidden").addClass("next content-hidden")},ArticleAnimator.currentElementClone=function(){return this.$page.clone().removeClass("hidden").addClass("current")},function(){function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,f=e.EventEmitter;d.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;a.length>b;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;a.length>b;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=f,a},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}.call(this),function(a){function b(b){var c=a.event;return c.target=c.target||c.srcElement||b,c}var c=document.documentElement,d=function(){};c.addEventListener?d=function(a,b,c){a.addEventListener(b,c,!1)}:c.attachEvent&&(d=function(a,c,d){a[c+d]=d.handleEvent?function(){var c=b(a);d.handleEvent.call(d,c)}:function(){var c=b(a);d.call(a,c)},a.attachEvent("on"+c,a[c+d])});var e=function(){};c.removeEventListener?e=function(a,b,c){a.removeEventListener(b,c,!1)}:c.detachEvent&&(e=function(a,b,c){a.detachEvent("on"+b,a[b+c]);try{delete a[b+c]}catch(d){a[b+c]=void 0}});var f={bind:d,unbind:e};"function"==typeof define&&define.amd?define("eventie/eventie",f):a.eventie=f}(this),function(a){function b(a,b){for(var c in b)a[c]=b[c];return a}function c(a){return"[object Array]"===i.call(a)}function d(a){var b=[];if(c(a))b=a;else if("number"==typeof a.length)for(var d=0,e=a.length;e>d;d++)b.push(a[d]);else b.push(a);return b}function e(a,c){function e(a,c,g){if(!(this instanceof e))return new e(a,c);"string"==typeof a&&(a=document.querySelectorAll(a)),this.elements=d(a),this.options=b({},this.options),"function"==typeof c?g=c:b(this.options,c),g&&this.on("always",g),this.getImages(),f&&(this.jqDeferred=new f.Deferred);var h=this;setTimeout(function(){h.check()})}function i(a){this.img=a}function j(a){this.src=a,k[a]=this}e.prototype=new a,e.prototype.options={},e.prototype.getImages=function(){this.images=[];for(var a=0,b=this.elements.length;b>a;a++){var c=this.elements[a];"IMG"===c.nodeName&&this.addImage(c);for(var d=c.querySelectorAll("img"),e=0,f=d.length;f>e;e++){var g=d[e];this.addImage(g)}}},e.prototype.addImage=function(a){var b=new i(a);this.images.push(b)},e.prototype.check=function(){function a(a,e){return b.options.debug&&h&&g.log("confirm",a,e),b.progress(a),c++,c===d&&b.complete(),!0}var b=this,c=0,d=this.images.length;if(this.hasAnyBroken=!1,!d)return void this.complete();for(var e=0;d>e;e++){var f=this.images[e];f.on("confirm",a),f.check()}},e.prototype.progress=function(a){this.hasAnyBroken=this.hasAnyBroken||!a.isLoaded;var b=this;setTimeout(function(){b.emit("progress",b,a),b.jqDeferred&&b.jqDeferred.notify(b,a)})},e.prototype.complete=function(){var a=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var b=this;setTimeout(function(){if(b.emit(a,b),b.emit("always",b),b.jqDeferred){var c=b.hasAnyBroken?"reject":"resolve";b.jqDeferred[c](b)}})},f&&(f.fn.imagesLoaded=function(a,b){var c=new e(this,a,b);return c.jqDeferred.promise(f(this))}),i.prototype=new a,i.prototype.check=function(){var a=k[this.img.src]||new j(this.img.src);if(a.isConfirmed)return void this.confirm(a.isLoaded,"cached was confirmed");if(this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");var b=this;a.on("confirm",function(a,c){return b.confirm(a.isLoaded,c),!0}),a.check()},i.prototype.confirm=function(a,b){this.isLoaded=a,this.emit("confirm",this,b)};var k={};return j.prototype=new a,j.prototype.check=function(){if(!this.isChecked){var a=new Image;c.bind(a,"load",this),c.bind(a,"error",this),a.src=this.src,this.isChecked=!0}},j.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},j.prototype.onload=function(a){this.confirm(!0,"onload"),this.unbindProxyEvents(a)},j.prototype.onerror=function(a){this.confirm(!1,"onerror"),this.unbindProxyEvents(a)},j.prototype.confirm=function(a,b){this.isConfirmed=!0,this.isLoaded=a,this.emit("confirm",this,b)},j.prototype.unbindProxyEvents=function(a){c.unbind(a.target,"load",this),c.unbind(a.target,"error",this)},e}var f=a.jQuery,g=a.console,h=void 0!==g,i=Object.prototype.toString;"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],e):a.imagesLoaded=e(a.EventEmitter,a.eventie)}(window),function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){a.fn.fluidbox=function(b){var c=a.extend(!0,{viewportFill:.95,overlayColor:"rgba(255,255,255,.85)",debounceResize:!0,stackIndex:1e3,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}]},b);c.stackIndex<c.stackIndexDelta&&(c.stackIndexDelta=c.stackIndex),$fbOverlay=a("<div />",{"class":"fluidbox-overlay",css:{"background-color":c.overlayColor,"z-index":c.stackIndex}});var d,e=this,f=a(window),g=function(){a(".fluidbox-opened").trigger("click")},h=function(a){var b=a.find("img"),c=a.find(".fluidbox-ghost"),d=f.scrollTop()-b.offset().top+.5*b.data("imgHeight")*(b.data("imgScale")-1)+.5*(f.height()-b.data("imgHeight")*b.data("imgScale")),e=.5*b.data("imgWidth")*(b.data("imgScale")-1)+.5*(f.width()-b.data("imgWidth")*b.data("imgScale"))-b.offset().left,g=b.data("imgScale");c.css({transform:"translate("+parseInt(10*e)/10+"px,"+parseInt(10*d)/10+"px) scale("+parseInt(1e3*g)/1e3+")"})},i=function(){d=f.width()/f.height(),e.each(function(){if(a(this).hasClass("fluidbox")){var b=a(this).find("img"),e=a(this).find(".fluidbox-ghost"),g=a(this).find(".fluidbox-wrap"),h=b.data();h.imgWidth=b.width(),h.imgHeight=b.height(),h.imgRatio=b.width()/b.height(),e.css({width:b.width(),height:b.height(),top:b.offset().top-g.offset().top,left:b.offset().left-g.offset().left}),h.imgScale=d>h.imgRatio?f.height()*c.viewportFill/b.height():f.width()*c.viewportFill/b.width()}})};return c.closeTrigger&&a.each(c.closeTrigger,function(b){var d=c.closeTrigger[b];"window"!=d.selector?"document"==d.selector?d.keyCode?a(document).on(d.event,function(a){a.keyCode==d.keyCode&&g()}):a(document).on(d.event,g):a(document).on(d.event,c.closeTrigger[b].selector,g):f.on(d.event,g)}),e.imagesLoaded().done(function(){e.each(function(){if(a(this).is("a")&&1===a(this).children().length&&a(this).children().is("img")){var b=a("<div />",{"class":"fluidbox-wrap",css:{"z-index":c.stackIndex-c.stackIndexDelta}});a(this).addClass("fluidbox").wrapInner(b).find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />')}}),i();var b=function(){i();var b=a("a[data-fluidbox].fluidbox-opened");b.length>0&&h(b)};c.debounceResize?a(window).smartresize(b):a(window).resize(b),e.click(function(b){if(a(this).hasClass("fluidbox")){var d=a(this),e=a(this).find("img"),f=a(this).find(".fluidbox-ghost"),g=a(this).find(".fluidbox-wrap"),i={};0!==a(this).data("fluidbox-state")&&a(this).data("fluidbox-state")?(d.data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),i.open&&window.clearTimeout(i.open),i.close=window.setTimeout(function(){a(".fluidbox-overlay").remove(),g.css({"z-index":c.stackIndex-c.stackIndexDelta})},10),a(".fluidbox-overlay").css({opacity:0}),f.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd",function(){e.css({opacity:1}),i.hideGhost=window.setTimeout(function(){f.css({opacity:0})},250)})):a("<img />",{src:e.attr("src")}).load(function(){d.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),i.close&&window.clearTimeout(i.close),i.hideGhost&&window.clearTimeout(i.hideGhost),i.open=window.setTimeout(function(){a(".fluidbox-overlay").css({opacity:1})},10),g.css({"z-index":c.stackIndex+c.stackIndexDelta}),f.off("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd transitionEnd").css({"background-image":"url("+e.attr("src")+")",opacity:1}),e.css({opacity:0});var b=new Image;b.onload=function(){f.css({"background-image":"url("+d.attr("href")+")"})},b.src=d.attr("href"),h(d)}),b.preventDefault()}})}),e}}(jQuery),function(a){"use strict";a.fn.pin=function(b){var c=0,d=[],e=!1,f=a(window);b=b||{};var g=function(){for(var c=0,g=d.length;g>c;c++){var h=d[c];if(b.minWidth&&f.width()<=b.minWidth)h.parent().is(".pin-wrapper")&&h.unwrap(),h.css({width:"",left:"",top:"",position:""}),e=!0;else{e=!1;var i=b.containerSelector?h.closest(b.containerSelector):a(document.body),j=h.offset(),k=i.offset(),l=h.offsetParent().offset();h.parent().is(".pin-wrapper")||h.wrap("<div class='pin-wrapper'>"),h.data("pin",{from:b.containerSelector?k.top:j.top,to:k.top+i.height()-h.outerHeight(),end:k.top+i.height(),parentTop:l.top}),h.css({width:h.outerWidth()}),h.parent().css("height",h.outerHeight())}}},h=function(){if(!e){c=f.scrollTop();for(var b=0,g=d.length;g>b;b++){var h=a(d[b]),i=h.data("pin"),j=i.from,k=i.to;j+h.outerHeight()>i.end?h.css("position",""):c>j&&k>c?"fixed"!=h.css("position")&&h.css({left:h.offset().left,top:0}).css("position","fixed"):c>=k?h.css({left:"auto",top:k-i.parentTop}).css("position","absolute"):h.css({position:"",top:"",left:""})}}},i=function(){g(),h()};return this.each(function(){var b=a(this),c=a(this).data("pin")||{};c&&c.update||(d.push(b),a("img",this).one("load",g),c.update=i,a(this).data("pin",c))}),f.scroll(h),f.resize(function(){g()}),g(),f.load(i),this}}(jQuery),$(document).ready(function(){function a(a){function b(a){return $.getJSON("/json/post_"+a+".json",function(a){c=a.title}),c}var c,d=0,e=0,f=$("section.posts article");for(d;5>d;d++){e++;var g=a-e;$("<a>").attr("href","/blog/#"+g).text(b(g)).appendTo(f)}}$.ajaxSetup({async:!1}),$body=$(document.body),$window=$(window),$html=$(document.documentElement),$browser_height=$(window).height(),$(".imgs").length&&$(".imgs a").fluidbox(),a(numPosts),$("#info").on("click",function(a){a.preventDefault(),$(".cover").addClass("open"),$("#middle").addClass("info-open")}),$(window).scroll(function(){var a=$($window).scrollTop();$("#slide .scroll").css("opacity",1-(a-.25*$browser_height)/(.8*$browser_height))}),$("#blog").on("click",function(a){a.preventDefault(),ArticleAnimator.load()}),$(".dark").on("click",function(a){a.preventDefault(),$body.css({overflow:"auto"}),$("div.blog").removeClass("open"),$("div.dark").fadeOut("fast"),$(".page.current, .page.next").remove()})});