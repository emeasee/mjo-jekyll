function elementToTemplate(a){return a.get(0).outerHTML}function scrollTop(){$body.add($html).scrollTop(0)}function pageState(){return{index:ArticleAnimator.currentPostIndex,current:elementToTemplate(ArticleAnimator.$current),next:elementToTemplate(ArticleAnimator.$next)}}function getURLIndex(){return parseInt(history.state&&history.state.index||window.location.hash.replace("#","")||ArticleAnimator.currentPostIndex)}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),jQuery.ajaxSetup({cache:!1});var ArticleAnimator=ArticleAnimator||{canScroll:!0,initialLoad:!0,animationDuration:500,postCount:numPosts,currentPostIndex:numPosts,postCache:{},pageTemplate:null};ArticleAnimator.load=function(){this.currentPostIndex=getURLIndex(),this.makeSelections(),$body.append(this.$current),$body.append(this.$next);var a=this;this.createPost({type:"current"},function(){a.createPost({type:"next"},function(){a.refreshCurrentAndNextSelection(),history.pushState(pageState(),"","#"+a.currentPostIndex),a.bindGotoNextClick(),a.bindPopstate(),a.bindWindowScroll()})})},ArticleAnimator.makeSelections=function(){this.$page=$(".page"),this.pageTemplate=elementToTemplate(this.$page.clone()),this.$current=this.currentElementClone(),this.$next=this.nextElementClone()},ArticleAnimator.getPost=function(a,b){if(b=b||$.noop,this.postCache[a])return b(this.postCache[a]),void 0;var c=this;$.getJSON("/json/post_"+a+".json",function(d){c.postCache[a]=d,b(d)})},ArticleAnimator.nextPostIndex=function(a){return 1===a?this.postCount:a-1},ArticleAnimator.createPost=function(a,b){a=a||{};var c=this,d=a.type||"next";a.fromTemplate&&($body.append(this.nextElementClone()),this["$"+d]=$("."+d));var e="next"==d?this.nextPostIndex(this.currentPostIndex):this.currentPostIndex;this.getPost(e,function(a){c.contentizeElement(c["$"+d],a),b&&b()})},ArticleAnimator.contentizeElement=function(a,b){a.find(".big-image").css({backgroundImage:"url("+b.image+")"}),a.find("h1.title").html(b.title),a.find("h2.description").html(b.title_secondary),a.find(".content .text").html(b.content),a.find("h3.byline time").html(b.date),a.find("h3.byline .author").html(b.author)},ArticleAnimator.animatePage=function(a){var b=this,c=this.$next.get(0).getBoundingClientRect().top;this.canScroll=!1,this.$current.addClass("fade-up-out"),this.$next.removeClass("content-hidden next").addClass("easing-upward").css({transform:"translate3d(0, -"+c+"px, 0)"}),setTimeout(function(){scrollTop(),b.$next.removeClass("easing-upward"),b.$current.remove(),b.$next.css({transform:""}),b.$current=b.$next.addClass("current"),b.canScroll=!0,b.currentPostIndex=b.nextPostIndex(b.currentPostIndex),a()},b.animationDuration)},ArticleAnimator.bindGotoNextClick=function(){var a=this,b="ontouchstart"in window?"touchstart":"click";this.$next.find(".big-image").on(b,function(b){b.preventDefault(),$(this).unbind(b),a.animatePage(function(){a.createPost({fromTemplate:!0,type:"next"}),a.bindGotoNextClick(),history.pushState(pageState(),"","#"+a.currentPostIndex)})})},ArticleAnimator.bindPopstate=function(){var a=this;$window.on("popstate",function(){return!history.state||a.initialLoad?(a.initialLoad=!1,void 0):(a.currentPostIndex=history.state.index,a.$current.replaceWith(history.state.current),a.$next.replaceWith(history.state.next),a.refreshCurrentAndNextSelection(),a.createPost({type:"next"}),a.bindGotoNextClick(),void 0)})},ArticleAnimator.bindWindowScroll=function(){var a=this;$window.on("mousewheel",function(b){a.canScroll||b.preventDefault()})},ArticleAnimator.refreshCurrentAndNextSelection=function(){this.$current=$(".page.current"),this.$next=$(".page.next")},ArticleAnimator.nextElementClone=function(){return this.$page.clone().removeClass("hidden").addClass("next content-hidden")},ArticleAnimator.currentElementClone=function(){return this.$page.clone().removeClass("hidden").addClass("current")},$(document).ready(function(){$body=$(document.body),$window=$(window),$html=$(document.documentElement),$("#top .scroll").scroll(function(){var a=$(this).scrollTop(),b=$(this).innerHeight(),c=this.scrollHeight;a>=c-b&&($("#top").css("display","none"),$("div.middle").css("position","relative"))})});